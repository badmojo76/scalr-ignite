name: Clone Private Repo

on:
  release:
    types: [created]
  workflow_dispatch:

jobs:
  clone-repo:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: webfactory/ssh-agent@v0.7.0
      with:
         ssh-private-key: ${{ secrets.PK_PUBLISH }}
    - name: Clone private repository to public repository
      run: |
        echo "Check SSH connectivity/authentication..."
        # ssh -vT git@github.com
        export GIT_SSH_COMMAND="ssh -T"
        git pull
        echo "Renaming origin..."
        git remote rename origin private
        echo "Adding public as remote..."
        git remote add origin git@github.com:sierra-cedar/scalr-ignite
        git fetch --unshallow private
        git config --global user.email "noreply-publish@sierra-cedar.com"
        git config --global user.name "Github Action - Publish" 
        # git pull --rebase origin main
        rm -Rf .github
        git add .
        git commit -m "Cleanup for Release"
        # git push -u private main
        echo "Publishing..."
        git push -u origin main


        # cd ~
        # echo "clone public repo"
        # git config --global user.email "noreply@sierra-cedar.com"
        # git config --global user.name "Github Action - Publish" 
        # git clone git@github.com:sierra-cedar/scalr-ignite
        # cd scalr-ignite
        # touch test.file
        # git add .
        # git commit -m "test file"
        # git push
        # cd ~/scalr-ignite-internal

#        eval `ssh-agent -s`
#        ssh-add - <<< '${{ secrets.PK_PUBLISH }}'

#        git clone github.com:sierra-cedar/scalr-ignite-internal

# # This is a basic workflow to help you get started with Actions

# name: CI-Publish-to-Public-Repo
#   # Triggers the workflow on push or pull request events but only for the "main" branch
# on:
#   push:
#     branches:
#       - 'releases/**'
#       - '!releases/**-alpha'
#   # Allows you to run this workflow manually from the Actions tab
#   workflow_dispatch:

# # A workflow run is made up of one or more jobs that can run sequentially or in parallel
# jobs:
#   # This workflow contains a single job called "build"
#   publish:
#     # The type of runner that the job will run on
#     runs-on: ubuntu-latest

#     # Steps represent a sequence of tasks that will be executed as part of the job
#     steps:
#     - name: Duplicate Release With Asset to public_Repo
#       id: Release-AIO
#       uses: Hs1r1us/Release-AIO@v2.0.0
#       env:
#         GITHUB_TOKEN: ${{ secrets.PRIVATE_TOKEN }} # You need a new token to access the target Repository
#       with:
#         tag_name: 'inherit' # Must use 'inherit' to get the latest release
#         body: 'hello world' # Will be added in the new release
#         repo: 'sierra-cedar/scalr-ignite' # The format is like owner/repo
# #        asset_files: './asset_file' # Will be added in the new release
